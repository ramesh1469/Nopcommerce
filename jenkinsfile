pipeline{
    agent { label "Docker"}
    stages{
        stage ("git clone"){
            steps{
                git url: "https://github.com/ramesh1469/Nopcommerce.git",
                branch: "main"

            }
        }
        stage ("build & SonarQube analysis"){
            agent { label "Docker"}
            steps{
                withSonarQubeEnv('sonar') {
                sh 'dotnet sonarscanner begin /k:"sonar" /d:sonar.host.url="http://3.141.34.170:32768"  /d:sonar.token="sqp_1b439582af8ac65313432e37a33ce4157cb7aa87"',
                sh 'dotnet build',
                sh 'dotnet sonarscanner end /d:sonar.token="sqp_1b439582af8ac65313432e37a33ce4157cb7aa87"'
            }
          }
        }
        stage ("docker image"){
            steps{
                sh "docker image build -t ram:1.0 ."
            }
        }
    }
}
